<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>What is probabilistic programming &mdash; monad-bayes  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Developer Guide" href="usage.html" />
    <link rel="prev" title="Welcome to monad-bayes’s documentation!" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> monad-bayes
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">What is probabilistic programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="#motivating-examples">Motivating examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="#api-docs">API docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html#references">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html#the-core-typeclasses">The core typeclasses</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html#interpreters">Interpreters</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html#cheat-sheet">Cheat Sheet</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">monad-bayes</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>What is probabilistic programming</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/probprog.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="what-is-probabilistic-programming">
<h1>What is probabilistic programming<a class="headerlink" href="#what-is-probabilistic-programming" title="Permalink to this headline"></a></h1>
<p>Probabilistic programming is all about being able to write programs like:</p>
<div class="highlight-haskell= notranslate"><div class="highlight"><pre><span></span>sprinkler :: MonadInfer m =&gt; m Bool
sprinkler = do
  rain &lt;- bernoulli 0.3
  sprinkler &lt;- bernoulli $ if rain then 0.1 else 0.4
  wet &lt;- bernoulli $ case (rain, sprinkler) of
    (True, True) -&gt; 0.98
    (True, False) -&gt; 0.8
    (False, True) -&gt; 0.9
    (False, False) -&gt; 0.0
  condition (not wet)
  return rain
</pre></div>
</div>
<p>and doing then do inference like this:</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="nf">enumerate</span> <span class="n">sprinkler</span>
</pre></div>
</div>
<p>to get</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[(</span><span class="kc">False</span><span class="p">,</span><span class="mf">0.8914</span><span class="p">),(</span><span class="kc">True</span><span class="p">,</span><span class="mf">0.1086</span><span class="p">)]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">sprinkler</span></code> is a distribution over values for the Boolean <code class="docutils literal notranslate"><span class="pre">rain</span></code> variable given the likelihood and observation specified above.</p>
<p><code class="docutils literal notranslate"><span class="pre">sprinkler</span></code> is a distribution. But it’s a distribution specified as a program with randomness (e.g. <code class="docutils literal notranslate"><span class="pre">bernoulli</span></code>) and scoring (e.g. <code class="docutils literal notranslate"><span class="pre">condition</span></code>). Hence: probabilistic programming. The Grand Vision is that you write your statistical model as a probabilistic program and then do inference. To quote <a class="reference external" href="https://webppl.readthedocs.io/en/master/inference/">this page</a>, “marginal inference (or just inference) is the process of reifying the distribution on return values implicitly represented by a stochastic computation.”. That is, a probabilistic program (stochastic computation) is an abstract object and inference transforms it into something concrete.</p>
<!-- " -->
<!-- Here I use "inference" to mean the process of getting from the distribution in the abstract the something concrete, like samples from it,  an expectation over it, parameters of it, or in the above case of `enumerate`, the mass of each element of the support. -->
<!-- You then want to be able to convert this abstract specification of a distribution or model into something tangible, and in the case of this simple discrete distribution, we can do so by brute force. That's what `enumerate` does. -->
<p>The thing about inference is that most distributions that are of interest are not as simple as <code class="docutils literal notranslate"><span class="pre">sprinkler</span></code>. They could have continuous random variables, a huge number of them, or even a number of them that is itself random. They could involve a series of observations, interspersed with other sources of randomness.</p>
<p>Designing a language in which you can specify arbitrarily complex models as probabilistic programs turns out to be a largely solved problem. The hard part is designing a language where you can specify how you want to do inference, because sophisticated, often approximate, inference methods are almost always necessary for the models involved in solving real world problems.</p>
<p>That’s really the focus of monad-bayes. It’s a surprising and beautiful library, but like most of Haskell, merits a lot of unpacking. As such, the goal of this document is to walk through how it works.</p>
<!-- It feels natural that a pure, functional, strongly typed language like Haskell should have a good story for Bayesian probability, inference, and probabilistic programming.  -->
<!-- denotation of probabilistic programs, which we then are free to interpret in myriad ways: as weighted lists, samplers, or a variety of more sophisticated programs for performing inference -->
<!-- In particular, these interpretations can be combined, and by so doing, you can built up really rather complex inference algorithms while being sure that your method is sound. And also intelligible.  -->
<!-- *The interpretation of your model is the program which performs inference on it* -->
</section>
<section id="motivating-examples">
<h1>Motivating examples<a class="headerlink" href="#motivating-examples" title="Permalink to this headline"></a></h1>
<p><code class="docutils literal notranslate"><span class="pre">sprinkler</span></code> above is a great example of the two new things you can do in a probabilistic program that you can’t do in other programs: you can draw from distributions, and you can <em>condition</em> on observations. For example:</p>
<div class="highlight-haskell= notranslate"><div class="highlight"><pre><span></span>example = do
    ind &lt;- fmap not (bernoulli 0.9)
    val &lt;- if ind then gaussian 0 1 else poisson 0.5
    condition (val &gt; 1)
    return ind
</pre></div>
</div>
<p>This example is contrived, in order to show a few things. First, <code class="docutils literal notranslate"><span class="pre">m</span></code> in distributions like <code class="docutils literal notranslate"><span class="pre">bernoulli</span> <span class="pre">0.9</span> <span class="pre">::</span> <span class="pre">MonadSample</span> <span class="pre">m</span> <span class="pre">=&gt;</span> <span class="pre">m</span> <span class="pre">Bool</span></code> (the distribution <code class="docutils literal notranslate"><span class="pre">{True</span> <span class="pre">:</span> <span class="pre">0.9,</span> <span class="pre">False:</span> <span class="pre">0.1}</span></code>) are functors, so we can fmap over them, e.g. with <code class="docutils literal notranslate"><span class="pre">not</span></code> to get the distribution <code class="docutils literal notranslate"><span class="pre">{True</span> <span class="pre">:</span> <span class="pre">0.1,</span> <span class="pre">False:</span> <span class="pre">0.9}</span></code>. Second, distributions are monads, so we can draw from them and use the results as the parameters of other distributions. Third, we have a <code class="docutils literal notranslate"><span class="pre">condition</span></code> function, which throws out all values of <code class="docutils literal notranslate"><span class="pre">ind</span></code> which would result in <code class="docutils literal notranslate"><span class="pre">val</span> <span class="pre">&lt;=</span> <span class="pre">1</span></code>.</p>
<p>The fact that distributions are a monad is the essence of probabilistic programming. It allows you to express everything from simple models (Bayesian linear regression) to complex ones (hierarchical latent Dirichlet models) in a shared language. See the <code class="docutils literal notranslate"><span class="pre">models</span></code> folder (TODO LINK) for examples.</p>
<div class="highlight-haskell= notranslate"><div class="highlight"><pre><span></span>betaBernoulli :: MonadSample m =&gt; Int -&gt; m [Bool]
betaBernoulli n = do
  weight &lt;- uniform 0 1
  let toss = bernoulli weight
  replicateM n toss
</pre></div>
</div>
<p>And, because we’re programming directly in Haskell, rather than a domain specific language (like Church, Gen, WebPPL and most other probabilistic programming languages), we can interoperate with any other Haskell concepts. Two examples:</p>
<div class="highlight-haskell= notranslate"><div class="highlight"><pre><span></span>model :: (MonadError String m, MonadInfer m) =&gt; m Int
model = do
    x &lt;- uniformD [0..10]
    conditionAllowingForFailure (x &lt; 0)
    return x

conditionAllowingForFailure :: (MonadSample m, MonadError [Char] m, MonadCond m) 
    =&gt; Bool -&gt; m ()
conditionAllowingForFailure b = do 
    fail &lt;- bernoulli 0.1
    when fail $ throwError &quot;fail&quot;
    condition b

main :: [(Either String Int, Double)]
main = enumerate $ runExceptT model
-- &gt;&gt;&gt; main
-- [(Left &quot;fail&quot;,1.0),(Right 0,0.0),(Right 1,0.0),(Right 2,0.0),(Right 3,0.0),(Right 4,0.0),(Right 5,0.0),(Right 6,0.0),(Right 7,0.0),(Right 8,0.0),(Right 9,0.0),(Right 10,0.0)]
</pre></div>
</div>
<p>Here, I’ve added <code class="docutils literal notranslate"><span class="pre">ExceptT</span></code> to my probability monad, which allows me to throw errors. The result is that I can write a version of <code class="docutils literal notranslate"><span class="pre">condition</span></code> which results in a safe failure when I condition on something that is always false.</p>
<div class="highlight-haskell= notranslate"><div class="highlight"><pre><span></span>recursion scheme example: pcfg
</pre></div>
</div>
</section>
<section id="api-docs">
<h1>API docs<a class="headerlink" href="#api-docs" title="Permalink to this headline"></a></h1>
<p>For API docs, see <a class="reference external" href="https://hackage.haskell.org/package/monad-bayes">hackage</a>.</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Welcome to monad-bayes’s documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="usage.html" class="btn btn-neutral float-right" title="Developer Guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Adam Scibior.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>